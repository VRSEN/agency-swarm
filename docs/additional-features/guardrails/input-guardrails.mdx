---
title: "Input Guardrails"
description: "Validate incoming messages before they reach the agent"
icon: "arrow-right-to-bracket"
---

Input guardrails validate incoming messages **before** they reach the agent. They screen both user input and inter-agent communication. Agency Swarm extracts text content for you, so guardrails receive clean text.

## Function Signature

```python
from agency_swarm import input_guardrail, GuardrailFunctionOutput, RunContextWrapper, Agent

@input_guardrail
async def my_guardrail(
    context: RunContextWrapper,
    agent: Agent,
    user_input: str | list[str]
) -> GuardrailFunctionOutput:
    return GuardrailFunctionOutput(
        tripwire_triggered=False,
        output_info="",
    )
```

**Parameters:**
- `context`: Run context with shared state
- `agent`: The agent receiving the input
- `user_input`: Text content (string or list of strings for multiple messages)

<Note>
File and image inputs inside messages are not passed to the guardrail.
</Note>

## Multiple Messages

If a user sends multiple messages, your guardrail receives a list:

```python
["Hi", "How are you?"]
```

## Basic Example

```python
@input_guardrail
async def require_prefix(
    ctx: RunContextWrapper, agent: Agent, user_input: str | list[str]
) -> GuardrailFunctionOutput:
    text = user_input if isinstance(user_input, str) else " ".join(user_input)
    if not text.startswith("Request:"):
        return GuardrailFunctionOutput(
            output_info="Start your message with 'Request:'",
            tripwire_triggered=True,
        )
    return GuardrailFunctionOutput(output_info="", tripwire_triggered=False)

agent = Agent(
    name="Support",
    instructions="Help customers.",
    input_guardrails=[require_prefix],
)
```

## Friendly vs Strict Mode

The `throw_input_guardrail_error` parameter controls how guidance is delivered.

| Mode | `throw_input_guardrail_error` | Caller Sees | Persisted As | Use Case |
|------|-------------------------------|-------------|--------------|----------|
| **Friendly** | `False` (default) | Guidance as `final_output` | Assistant message | Conversational flows, agent-to-agent |
| **Strict** | `True` | `InputGuardrailTripwireTriggered` exception | System message | Hard requirements, security |

<Note>
The `validation_attempts` parameter does not apply to input guardrails.
</Note>

## Message History

Each guardrail trigger is recorded with a `message_origin` field:

| Origin | Meaning |
|--------|---------|
| `input_guardrail_message` | Input guardrail in friendly mode |
| `input_guardrail_error` | Input guardrail in strict mode |
| `output_guardrail_error` | Output guardrail (system message) |

## Advanced Examples

<Accordion title="Judge agent pattern" defaultOpen={false}>

```python
from agency_swarm import Agent, GuardrailFunctionOutput, RunContextWrapper, input_guardrail
from pydantic import BaseModel

class RelevanceDecision(BaseModel):
    is_relevant: bool
    reason: str

guardrail_agent = Agent(
    name="GuardrailAgent",
    instructions="Allow billing, account access, and troubleshooting.",
    model="gpt-5-mini",
    output_type=RelevanceDecision,
)

@input_guardrail
async def require_support_topic(
    context: RunContextWrapper, agent: Agent, user_input: str | list[str]
) -> GuardrailFunctionOutput:
    text = user_input if isinstance(user_input, str) else "\n".join(user_input)
    result = await guardrail_agent.get_response(text)
    if not result.final_output.is_relevant:
        return GuardrailFunctionOutput(
            output_info="Only support questions are allowed.",
            tripwire_triggered=True,
        )
    return GuardrailFunctionOutput(output_info="", tripwire_triggered=False)
```

</Accordion>

<Accordion title="Streaming event shape in friendly mode" defaultOpen={false}>

```text
RunItemStreamEvent(
  name='message_output_created',
  item=MessageOutputItem(
    raw_item=ResponseOutputMessage(
      id='msg_input_guardrail_guidance',
      role='assistant',
      status='completed'
    )
  )
)
```

</Accordion>

<Accordion title="Message history payload examples" defaultOpen={false}>

```json
[
  {"role": "assistant", "message_origin": "input_guardrail_message"},
  {"role": "system", "message_origin": "input_guardrail_error"}
]
```

</Accordion>
See [`examples/guardrails_input.py`](https://github.com/VRSEN/agency-swarm/blob/main/examples/guardrails_input.py) for a full example.
