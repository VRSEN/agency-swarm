---
title: "Output Guardrails Advanced"
description: "Agent-to-agent validation and message history."
icon: "arrow-right-from-bracket"
---

## Agent-to-Agent Validation

Guardrails can enforce message formats between agents.

```python
from agency_swarm import Agent, GuardrailFunctionOutput, input_guardrail, output_guardrail

@input_guardrail(name="RequireTaskPrefix")
async def require_task_prefix(context, agent, agent_input: str | list[str]) -> GuardrailFunctionOutput:
    text = agent_input if isinstance(agent_input, str) else " ".join(agent_input)
    condition = not text.startswith("Task:")
    return GuardrailFunctionOutput(
        output_info="ERROR: Requests must begin with 'Task:'" if condition else "",
        tripwire_triggered=condition,
    )

@output_guardrail(name="RequireResponsePrefix")
async def require_response_prefix(context, agent, response_text: str) -> GuardrailFunctionOutput:
    condition = not response_text.startswith("Response:")
    return GuardrailFunctionOutput(
        output_info="ERROR: Responses must start with 'Response:'" if condition else "",
        tripwire_triggered=condition,
    )

ceo = Agent(name="CEO", instructions="You are the CEO agent.")
worker = Agent(
    name="Worker",
    instructions="You are the worker agent.",
    input_guardrails=[require_task_prefix],
    output_guardrails=[require_response_prefix],
    throw_input_guardrail_error=True,
)
```

## Message History

Output guardrail failures are recorded as system messages:

```json
{
  "role": "system",
  "content": "Do not include email addresses.",
  "message_origin": "output_guardrail_error"
}
```

<Note>
For internal agents, friendly mode (`throw_input_guardrail_error=False`) keeps guardrail guidance flowing without exceptions.
</Note>
