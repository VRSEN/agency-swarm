---
title: "Input Guardrails Advanced"
description: "Judge agents, streaming behavior, and message history."
icon: "arrow-right-to-bracket"
---

## Judge Agents

Use a dedicated agent to decide if input is valid.

```python
from agency_swarm import (
    Agent,
    GuardrailFunctionOutput,
    RunContextWrapper,
    input_guardrail,
)
from pydantic import BaseModel

class RelevanceDecision(BaseModel):
    is_relevant: bool
    reason: str

guardrail_agent = Agent(
    name="GuardrailAgent",
    instructions=(
        "You screen incoming messages for a support agent. "
        "Allow account access, billing, and troubleshooting."
    ),
    model="gpt-5-mini",
    output_type=RelevanceDecision,
)

@input_guardrail
async def require_support_topic(
    context: RunContextWrapper, agent: Agent, user_input: str | list[str]
) -> GuardrailFunctionOutput:
    text = user_input if isinstance(user_input, str) else "\n".join(user_input)
    result = await guardrail_agent.get_response(text)
    decision = result.final_output
    if not decision.is_relevant:
        return GuardrailFunctionOutput(
            output_info="Only support questions are allowed.",
            tripwire_triggered=True,
        )
    return GuardrailFunctionOutput(output_info="", tripwire_triggered=False)
```

## Streaming Behavior

In friendly mode, guidance appears as a streaming event:

```
RunItemStreamEvent(
    name='message_output_created',
    item=MessageOutputItem(
        raw_item=ResponseOutputMessage(
            id='msg_input_guardrail_guidance',
            content=[ResponseOutputText(text="Prefix your request...")],
            role='assistant',
            status='completed'
        )
    )
)
```

## Message History

Guardrail triggers are recorded with `message_origin`.

```json
[
  {
    "role": "assistant",
    "content": "Please prefix your request with 'Support:'",
    "message_origin": "input_guardrail_message"
  },
  {
    "role": "system",
    "content": "Only support questions are allowed.",
    "message_origin": "input_guardrail_error"
  }
]
```

See [`examples/guardrails_input.py`](https://github.com/VRSEN/agency-swarm/blob/main/examples/guardrails_input.py) for full examples.
